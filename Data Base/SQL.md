<!--
 * @Author: YangFang
 * @Date: 2025-03-11 17:05:49
 * @LastEditTime: 2025-04-15 13:51:37
 * @Description: 
-->
# SQL 数据库笔记

## 数据库基本概念

### 数据库系统概述
- **数据**：是数据库中存储的基本对象，是描述事物的符号记录
- **数据的分类**：文本、图形、图像、音频、视频。
- **数据库DB**：是长期存储在计算机内、有组织的、可共享的大量数据的集合。
- **数据库的基本特征**：数据按照一定的数据模型组织、描述和存储。
  1. 可为各种用户共享
  2. 数据具有较小的冗余度
  3. 数据具有较高的数据独立性
  4. 数据具有较高的安全性
- **数据库系统DBS(Database System)**：是一个采用了数据库技术、有组织地、动态地存储大量相关数据、方便多用户访问的系统。由以下四个部分组成
  1. **数据库**：统一管理、长期存储在计算机内的，有组织的，可共享的大量数据的集合
  2. **硬件**：构成计算机系统包括存储数据所需的外部设备
  3. **软件**：操作系统、数据库管理系统 (DBMS)、应用程序。
  4. **人员**：系统分析和数据库设计人员、应用程序员、最终用户、数据库管理员 (DBA)。
- **数据库管理系统DBMS**：实现对共享数据有效地组织和存取。主要功能有：
  1. **数据定义**：定义数据库的结构和约束。
  2. **数据库操作**：支持数据的查询、插入、更新和删除。
  3. **数据库运行管理**：确保数据库的高效运行和数据一致性。
  4. **数据的存储管理**：管理数据的物理存储和访问。
  5. **数据库的建立和维护**：支持数据库的创建、备份、恢复和优化。
  
### 三级模式两级映射
- **三级模式**：数据库管理系统从三个层次来管理数据，分别是外部层，概念层，内部层，它们对应的模式分别是外模式，概念模式，内模式。
  1. **外模式**：面向应用程序，描述用户的数据视图（以视图的形式）。
  2. **概念模式**：又称模式，逻辑模式，面向数据库设计人员，描述数据库整体逻辑结构。(以表的形式)
  3. **内模式**：又称为物理模式，存储模式，面向物理上的数据库，描述数据在磁盘上如何存储(以文件的形式)
  基本表中的数据是实际存储在数据库中的，而用户的视图是查询或者计算出来的。因此一个数据库中的外模式有一个或者多个，而概念模式和内模式只有一个。
- **两级映射**：为了使三级模式之间产生关联，数据通过二级映像体现了逻辑独立性和物理独立性两个层面的数据独立性。
  1. **外模式/模式映射**：外模式和模式的对应关系。
    - **体现**：逻辑独立性。
    - **定义**：当修改了概念模式，不影响其上一层的外模式。
    - **示例**：将基本表的“库存”和“销量”拆分到另一张表中，概念模式发生更改，但通过改变外模式/概念模式的映像，可以继续为用户提供原有的视图。
  2. **模式/内模式映射**：模式和内模式的对应关系。
    - **体现**：物理独立性。
    - **定义**：修改了内模式，不影响其上层的概念模式和外模式。
    - **示例**：在Excel中将.xls文件另存为.xlsx文件，文件格式更换，但打开文件后显示的表格内容一般不会改变。在数据库中，更换存储结构或创建索引以加快查询速度，内模式发生改变，只需改变概念模式/内模式映像，就不会影响原有的概念模式。
    
### 数据库设计
#### 数据库设计的基本流程：记住每一步骤，并且记住每一步骤的产出物
1. **需求分析**：分析数据存储的要求。获得用户对系统的三个要求：信息要求、处理要求、系统要求。
- **产出物**：
  - 数据流图
  - 数据字典
  - 需求说明书

2. **概念结构设计**：设计E-R图（实体-联系图）。
- **产出物**：
  - E-R图
- **工作步骤**：
  - 选择局部应用
  - 逐一设计分E-R图
  - E-R图合并
  - **合并冲突**：
    - **属性冲突** 同一属性存在于不同的分E-R图中
    - **命名冲突** 相同意义的属性在不同分E-R图上有不同的命名或意义
    - **结构冲突** 同一实体在不同分E-R图中有不同的属性，或同一对象在不同分E-R图中被抽象为实体或属性
3. **逻辑结构设计**：将E-R图转换成关系模式。
- **产出物**：
  - 关系模型
  - 完整性约束
  - 用户视图
4. **物理设计**：确定数据分布、存储结构和访问方式。
- **产出物**：
  - 数据分布方案
  - 存储结构设计
  - 访问方式设计
5. **数据库实施**：根据逻辑设计和物理设计的结果建立数据库。
- **产出物**：
  - 数据库实例
  - 调试通过的应用程序
  - 组织好的数据入库
6. **数据库运行和维护**：数据库应用系统经过试运行后投入运行。

### 关系模型
- **ER模型（概念模型）**
- **关系模型** 

### 关系代数
- **简介**：关系代数是一种用于操作关系数据库的数学基础。
- **基本操作**：
  - **交**：取两个关系的公共部分。
  - **并**：将两个关系合并成一个关系。
  - **差**：从一个关系中减去另一个关系。
  - **笛卡尔积**：将两个关系的所有可能组合生成一个新的关系。
  - **投影**：从关系中选择特定的属性列。
  - **选择**：根据指定条件从关系中选择满足条件的元组。
  - **自然连接**：根据指定的条件将两个关系连接成一个新的关系。

## 规范化
### 控制
### 函数依赖
- **简介**：函数依赖是数据属性之间的依赖关系。
- **定义**：如果对于关系模式R(U)中的两个属性集X和Y，如果对于R(U)中的任意一个元组，X的值确定了Y的值，那么就称X函数确定Y，即Y函数依赖于X，记为X→Y。
- **性质**：
  - **自反性**：
    - 公式：如果 Y ⊆ X，则 X → Y
    - 解释：任何属性集都函数依赖于其子集
    - 示例：在学生表中，{学号, 姓名} → 学号
  - **增广性**：
    - 公式：如果 X → Y，则 X∪Z → Y∪Z
    - 解释：如果 X 函数依赖于 Y，那么 X∪Z 函数依赖于 Y∪Z
    - 示例：在学生表中，{学号, 姓名} → 学号，那么 {学号, 姓名, 班级} → 学号∪班级
  - **传递性**：
    - 公式：如果 X → Y 且 Y → Z，则 X → Z
    - 解释：展示了函数依赖的传递关系
    - 示例：在学生表中，学号→班级，班级→班主任，那么学号→班主任
  - **合并性**：
    - 公式：如果 X → Y 且 X → Z，则 X → Y∪Z
    - 解释：可以将多个函数依赖合并为一个
    - 示例：在学生表中，学号→姓名，学号→年龄，那么学号→{姓名, 年龄}
  - **分解性**：
    - 公式：如果 X → Y∪Z，则 X → Y 且 X → Z
    - 解释：可以将一个复合的函数依赖分解为多个简单的函数依赖
    - 示例：在学生表中，学号→{姓名, 年龄}，那么学号→姓名，学号→年龄

### 键与约束
- **超键**：
  - 能够唯一标识表中每一行的属性或属性组合
  - 可能包含多余的属性
  - 示例：在学生表中，(学号) 和 (学号, 姓名) 都是超键

- **候选键**：
  - 是最小的超键，即不包含多余属性的超键
  - 一个表可以有多个候选键
  - 示例：在学生表中，(学号) 是候选键，而 (学号, 姓名) 不是候选键，因为它包含了多余属性

- **主属性**：
  - 是候选键中的一个属性
  - 示例：在学生表中，(学号) 是候选键，其中 (学号) 是主属性

- **主键**：
  - 从候选键中选择一个作为主键
  - 用于唯一标识表中的每一行
  - 不能包含空值（NULL）
  - 示例：在学生表中，选择 (学号) 作为主键

- **外键**：
  - 用于建立表与表之间的关系
  - 指向另一个表的主键
  - 用于维护数据的一致性和完整性
  - 示例：在选课表中，(学号) 是外键，它指向学生表的主键

- **约束**：
  - 实体完整性：确保主键的唯一性
  - 参照完整性：确保外键的引用完整性
  - 用户定义的完整性：根据应用程序的要求定义的约束条件

### 范式
- **简介**：在ER模型转换成关系模型时，为了消除数据冗余和维护数据的完整性，需要对关系模式进行规范化处理。
- **第一范式（1NF）**:所有属性都是不可再分的
- **第二范式（2NF）**：
- **第三范式（3NF）**：
- **BCNF（Boyce-Codd 范式）**：
- **第四范式（4NF）**：